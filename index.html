<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <meta name="theme-color" content="#1e293b" id="themeColorMeta">
  <title>MeQR - デジタル名刺</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="MeQR">
  <link rel="apple-touch-icon" href="./icons/icon-192.svg">

  <link rel="stylesheet" href="css/style.css">
</head>

<body>
  <!-- スタートページ -->
  <div id="startPage" class="start-page" aria-live="polite">
    <div class="start-content">
      <div class="start-logo" aria-hidden="true">
        <div class="start-brand-mark"><span>Me</span></div>
      </div>
      <div class="start-app-name">MeQR</div>
      <div class="start-app-sub">DIGITAL BUSINESS CARD</div>
      <div class="start-divider"></div>
      <div class="start-catch">あなたの名刺を、スマートに。</div>
      <button class="start-btn" id="startBtn" type="button">はじめる</button>
    </div>
  </div>

  <div class="app-root">
    <header>
      <div class="brand">
        <div class="brand-mark" aria-hidden="true">
          <span>Me</span>
        </div>
        <div>
          <div class="brand-text-main">MeQR</div>
          <div class="brand-text-sub">DIGITAL BUSINESS CARD</div>
        </div>
      </div>
      <button id="btn-hamburger" class="hamburger-btn" type="button" title="メニューを開く">
        ☰
      </button>
    </header>

    <!-- Mode Toggle (Large, Improved) -->
    <div class="mode-toggle-large" role="tablist" aria-label="モード切替">
      <button id="btn-view-mode" class="active" role="tab" aria-selected="true">
        <span class="icon">👁️</span><span>表示モード</span>
      </button>
      <button id="btn-edit-mode" role="tab" aria-selected="false">
        <span class="icon">✏️</span><span>編集モード</span>
      </button>
    </div>

    <main>
      <section class="card" aria-label="デジタル名刺">
        <div class="card-header">
          <div class="photo-area">
            <img id="displayPhoto" alt="プロフィール写真" />
            <div class="photo-placeholder" id="photoPlaceholder">👤</div>
          </div>
          <div class="id-block">
            <div class="name-main" id="displayName">あなたの名前</div>
            <div class="name-sub" id="displayOrgRole">組織 / 役職</div>
            <div class="meta-chips">
              <span class="chip chip-strong">vCard 3.0</span>
              <span class="chip">LOCAL ONLY</span>
            </div>
          </div>
        </div>

        <div class="qr-shell" aria-label="連絡先QRコード">
          <div class="qr-inner">
            <div id="qrcode"></div>
          </div>
          <div class="brightness-tip">
            <span class="icon">🔆</span>
            <span>QRスキャン時は画面輝度を最大にすると読み取り精度が上がります。</span>
          </div>
        </div>
        <!-- QRサイズスライダー -->
        <div class="qr-size-slider-wrap">
          <span class="qr-size-label">QRサイズ</span>
          <input type="range" id="qr-size-slider" min="1" max="3" step="1" value="2" class="qr-size-slider">
          <span class="qr-size-indicator" id="qr-size-indicator">中</span>
        </div>

        <!-- アクションボタン -->
        <div class="action-buttons">
          <button id="btn-scan-qr" class="btn-ghost" type="button" title="QRコードをスキャン">
            <span class="icon">📷</span>
            <span>スキャン</span>
          </button>
          <button id="btn-share-vcard" class="btn-ghost" type="button" title="連絡先を共有">
            <span class="icon">📤</span>
            <span>共有</span>
          </button>
          <button id="btn-download-qr" class="btn-ghost" type="button" title="QRコードをダウンロード">
            <span class="icon">⬇️</span>
            <span>QR保存</span>
          </button>
          <button id="btn-export-pdf" class="btn-ghost" type="button" title="350DPIトンボ付きPDFを書き出し">
            <span class="icon">📄</span>
            <span>PDF</span>
          </button>
          <button id="btn-export-vcard" class="btn-ghost" type="button" title="vCardファイルをダウンロード">
            <span class="icon">💾</span>
            <span>.vcf</span>
          </button>
          <button id="btn-preview-vcard" class="btn-ghost" type="button" title="vCard内容を確認">
            <span class="icon">🔎</span>
            <span>確認</span>
          </button>
        </div>

        <!-- テーマ選択スライダー -->
        <div class="field-group" style="margin-top:16px;">
          <div class="field-label">デザインテンプレート</div>
          <div class="theme-slider">
            <button class="theme-item" data-template="washi">
              <div class="theme-preview" style="background: linear-gradient(135deg, #f5e6d3 0%, #e8d4b8 100%);"></div>
              <div class="theme-name">Washi</div>
            </button>
            <button class="theme-item" data-template="botanical">
              <div class="theme-preview" style="background: linear-gradient(135deg, #d4e8d4 0%, #b8d4b8 100%);"></div>
              <div class="theme-name">Botanical</div>
            </button>
            <button class="theme-item active" data-template="minimal">
              <div class="theme-preview" style="background: linear-gradient(135deg, #f0f0f0 0%, #e0e0e0 100%);"></div>
              <div class="theme-name">Minimal</div>
            </button>
            <button class="theme-item" data-template="corporate">
              <div class="theme-preview" style="background: linear-gradient(135deg, #e0e8f0 0%, #c8d4e0 100%);"></div>
              <div class="theme-name">Corporate</div>
            </button>
            <button class="theme-item" data-template="gradient">
              <div class="theme-preview" style="background: linear-gradient(135deg, #5C7A5F 0%, #343936 100%);"></div>
              <div class="theme-name">Gradient</div>
            </button>
          </div>
        </div>

        <!-- 名刺プレビュー -->
        <div class="preview-canvas-wrap" id="preview-canvas-wrap" aria-label="デザインテンプレートプレビュー">
          <canvas id="preview-canvas"></canvas>
        </div>


        <div class="contact-meta">
          <div class="contact-meta-left">
            <strong id="displayPhoneEmail">電話 / メール</strong>
            <span id="displayUrl" class="hint">URL（ポートフォリオ・SNSなど）</span>
          </div>
          <div class="sync-indicator">
            <span class="sync-dot"></span>
            <span id="syncStatusLabel">ローカル保存済み</span>
          </div>
        </div>

        <section class="form-root" id="editFormSection" aria-label="連絡先編集フォーム">
          <div class="field-group photo-upload-area">
            <div class="field-label">プロフィール写真</div>
            <label class="photo-upload-label">
              <span class="icon">📷</span>
              <span>写真を選択（任意）</span>
              <input id="photoUpload" type="file" accept="image/jpeg,image/png,image/webp">
            </label>
            <div class="hint">写真のサイズは200KB以下を推奨（大きいとQRコード生成に影響する場合があります）</div>
          </div>

          <div class="field-group">
            <div class="field-row">
              <div>
                <div class="field-label">姓 / LAST NAME</div>
                <div class="input-shell">
                  <input id="lastName" type="text" autocomplete="family-name" placeholder="山田" maxlength="20">
                </div>
              </div>
              <div>
                <div class="field-label">名 / FIRST NAME</div>
                <div class="input-shell">
                  <input id="firstName" type="text" autocomplete="given-name" placeholder="太郎" maxlength="20">
                </div>
              </div>
            </div>
          </div>

          <div class="field-group">
            <div class="field-label">連絡先 / CONTACT</div>
            <div class="input-shell">
              <input id="phone" type="tel" inputmode="tel" autocomplete="tel" placeholder="090-1234-5678"
                maxlength="20">
            </div>
            <div class="hint">携帯番号（ハイフンありでも可）</div>
          </div>

          <div class="field-group">
            <div class="field-label">メールアドレス / EMAIL</div>
            <div class="input-shell">
              <input id="email" type="email" inputmode="email" autocomplete="email" placeholder="example@example.com"
                maxlength="60">
            </div>
          </div>

          <div class="field-group">
            <div class="field-row">
              <div>
                <div class="field-label">会社名 / ORGANIZATION</div>
                <div class="input-shell">
                  <input id="org" type="text" autocomplete="organization" placeholder="株式会社〇〇" maxlength="40">
                </div>
              </div>
              <div>
                <div class="field-label">役職 / TITLE</div>
                <div class="input-shell">
                  <input id="title" type="text" autocomplete="organization-title" placeholder="営業部長" maxlength="30">
                </div>
              </div>
            </div>
          </div>

          <div class="field-group">
            <div class="field-label">URL / WEBSITE</div>
            <div class="input-shell">
              <input id="url" type="url" inputmode="url" autocomplete="url" placeholder="https://example.com"
                maxlength="100">
            </div>
            <div class="hint">個人サイト、ポートフォリオなど</div>
          </div>

          <div class="field-group">
            <div class="field-label">🔗 SNS・リンク（任意・2件まで）</div>
            <div style="display: flex; flex-direction: column; gap: 10px;">
              <div class="input-shell">
                <input id="sns1" type="url" inputmode="url" placeholder="例: https://x.com/yourname" maxlength="100">
              </div>
              <div class="input-shell">
                <input id="sns2" type="url" inputmode="url" placeholder="例: https://instagram.com/yourname"
                  maxlength="100">
              </div>
            </div>
            <div class="hint">SNS・ポートフォリオ・GitHubなど自由に入力（スマホ用QRに含まれます）</div>
          </div>

          <div class="footer-actions">
            <button id="btn-clear" type="button" class="btn-secondary">
              <span class="icon">🧹</span>
              <span>ローカル情報を削除</span>
            </button>
            <button id="btn-save" type="button" class="btn-primary">
              <span class="icon">💾</span>
              <span>保存してQRを更新</span>
            </button>
          </div>

          <div class="small-print">
            このアプリはサーバーに一切データを送信せず、<strong>ブラウザの localStorage のみ</strong>に保存します。
          </div>
        </section>

        <div style="display:flex; justify-content:space-between; align-items:center; margin-top:8px;">
          <div class="badge-offline" id="offlineBadge">
            <span class="dot dot-offline" id="offlineDot"></span>
            <span id="offlineText">オフライン未対応（初回読み込み中）</span>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Hamburger Menu -->
  <div id="menu-overlay" class="menu-overlay"></div>
  <div id="menu-drawer" class="menu-drawer">
    <div class="menu-header">
      <div class="menu-title">メニュー</div>
      <button id="menu-close-btn" class="menu-close-btn">✕</button>
    </div>
    <div class="menu-content">
      <div class="menu-item" id="menu-profiles">
        <span class="menu-item-icon">📇</span>
        <span class="menu-item-text">名刺を選ぶ</span>
        <span class="menu-item-arrow">›</span>
      </div>
      <div class="menu-divider"></div>
      <div class="menu-item" id="menu-share">
        <span class="menu-item-icon">📤</span>
        <span class="menu-item-text">共有する</span>
        <span class="menu-item-arrow">›</span>
      </div>
      <div class="menu-item" id="menu-sns">
        <span class="menu-item-icon">🔗</span>
        <span class="menu-item-text">SNS・リンク設定</span>
        <span class="menu-item-arrow">›</span>
      </div>
      <div class="menu-divider"></div>
      <div class="menu-item" id="menu-settings">
        <span class="menu-item-icon">⚙️</span>
        <span class="menu-item-text">設定</span>
        <span class="menu-item-arrow">›</span>
      </div>
      <div class="menu-item" id="menu-data">
        <span class="menu-item-icon">💾</span>
        <span class="menu-item-text">データの保存・削除</span>
        <span class="menu-item-arrow">›</span>
      </div>
      <div class="menu-divider"></div>
      <div class="menu-item" id="menu-help">
        <span class="menu-item-icon">❓</span>
        <span class="menu-item-text">ヘルプ・使い方</span>
      </div>
      <div class="menu-item" id="menu-about">
        <span class="menu-item-icon">ℹ️</span>
        <span class="menu-item-text">このアプリについて</span>
      </div>
    </div>
  </div>

  <!-- トースト通知用コンテナ -->
  <div id="toast-container" aria-live="polite"></div>

  <!-- カスタムダイアログ -->
  <div id="dialog-overlay" aria-modal="true" aria-hidden="true">
    <div id="dialog-box">
      <h2 id="dialog-title" class="dialog-title"></h2>
      <p id="dialog-message" class="dialog-message"></p>
      <input type="text" id="dialog-input" class="dialog-input" style="display: none;" autocomplete="off">
      <div id="dialog-actions" class="dialog-actions"></div>
    </div>
  </div>

  <!-- QRスキャンオーバーレイ -->
  <div id="scan-overlay" aria-label="QRコードスキャン">
    <div class="scan-overlay-title">QRコードを枠内に合わせてください</div>
    <div class="scan-frame">
      <video id="scan-video" playsinline muted></video>
    </div>
    <div class="scan-overlay-actions">
      <button type="button" id="scan-close-btn" class="btn-secondary">閉じる</button>
    </div>
  </div>

  <!-- Onboarding Overlay -->
  <div id="onboarding-overlay" class="onboarding-overlay">
    <div class="onboarding-card">
      <div class="onboarding-header">
        <h2>MeQRへようこそ！👋</h2>
        <p>プライバシー重視のシンプルなデジタル名刺アプリ</p>
      </div>
      <div class="onboarding-steps">
        <div class="onboarding-step">
          <div class="onboarding-step-number">1</div>
          <div class="onboarding-step-content">
            <h3>連絡先を入力</h3>
            <p>「編集」タブで名前・電話・メールなどを入力して保存</p>
          </div>
        </div>
        <div class="onboarding-step">
          <div class="onboarding-step-number">2</div>
          <div class="onboarding-step-content">
            <h3>QRコードで共有</h3>
            <p>相手にQRコードを見せてスキャンしてもらうだけ！</p>
          </div>
        </div>
        <div class="onboarding-step">
          <div class="onboarding-step-number">3</div>
          <div class="onboarding-step-content">
            <h3>複数の名刺を使い分け</h3>
            <p>ビジネス用・プライベート用など、用途に応じて切り替え可能</p>
          </div>
        </div>
        <div class="onboarding-step">
          <div class="onboarding-step-number">4</div>
          <div class="onboarding-step-content">
            <h3>完全プライバシー保護</h3>
            <p>データは全てローカル保存。サーバーには一切送信されません</p>
          </div>
        </div>
      </div>
      <div class="onboarding-footer">
        <button id="btn-onboarding-skip" class="onboarding-btn onboarding-btn-secondary">スキップ</button>
        <button id="btn-onboarding-start" class="onboarding-btn onboarding-btn-primary">使ってみる</button>
      </div>
    </div>
  </div>

  <!-- QRコード生成・読み取り -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.min.js"
    referrerpolicy="no-referrer">
    </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jsQR/1.4.0/jsQR.min.js" referrerpolicy="no-referrer">
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" referrerpolicy="no-referrer">
  </script>
  <script src="js/app.js" defer></script>
</body>

</html>